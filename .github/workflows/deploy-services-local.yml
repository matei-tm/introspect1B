name: Deploy Services (Local/Act)

on:
  workflow_dispatch:
    inputs:
      service:
        description: 'Service to deploy'
        required: true
        type: choice
        options:
          - all
          - product-service
          - order-service

env:
  AWS_REGION: us-east-1
  EKS_CLUSTER_NAME: dapr-demo-cluster
  ECR_REGISTRY: 322230759107.dkr.ecr.us-east-1.amazonaws.com
  NAMESPACE: dapr-demo

jobs:
  deploy:
    name: Deploy Services
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup environment
        run: |
          echo "Setting up environment for local execution..."
          echo "Service to deploy: ${{ github.event.inputs.service }}"

      - name: Run deployment script
        env:
          SERVICE: ${{ github.event.inputs.service }}
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        run: |
          cd src/eks-dapr-microservices
          chmod +x scripts/simulate-github-deploy.sh
          ./scripts/simulate-github-deploy.sh $SERVICE
